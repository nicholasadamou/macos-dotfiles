#! /usr/bin/env bash

declare current_dir && \
    current_dir="$(dirname "${BASH_SOURCE[0]}")" && \
    cd "${current_dir}"

# DESCRIPTION
# Executes the command line interface.

# SETTINGS
set -o errexit
set -o pipefail

# VARIABLES
declare DOTFILES_PATH="$HOME/dotfiles"

# LIBRARY
source "$DOTFILES_PATH"/lib/utilities.sh
source "$DOTFILES_PATH"/lib/options.sh

# EXECUTION
main() {
	bash "$DOTFILES_PATH"/base/base.sh

	clear

	if [[ -d "$HOME" ]]; then
		while true; do
			if [[ $# == 0 ]]; then
				printf "\n%s\n" "Usage: run OPTION"
				printf "\n%s\n" "Dotfile Options:"
				printf "  %s\n" "s: Show managed dotfiles."
				printf "  %s\n" "l: Symlink dotfiles (existing files are skipped)."
				printf "  %s\n" "d: Delete dotfiles."
				printf "  %s\n\n" "q: Quit/Exit."
				read -r -p "Enter selection: " response
				printf "\n"
				process_option "$response"
			else
				process_option "$1"
			fi
			break
		done
	else
		printf "%s\n" "ERROR: $HOME does not exist."
		return 1
	fi
}

main "$@"
