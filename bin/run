#!/bin/bash

declare current_dir && \
    current_dir="$(dirname "${BASH_SOURCE[0]}")" && \
    cd "${current_dir}"

# DESCRIPTION
# Executes the command line interface.

# SETTINGS
set -o errexit
set -o pipefail

# VARIABLES
declare DOTFILES_PATH="$HOME/dotfiles"

# LIBRARY
source "$DOTFILES_PATH"/lib/utilities.sh
source "$DOTFILES_PATH"/lib/options.sh

# EXECUTION
main() {
	if [[ -d "$HOME" ]]; then
		while true; do
			if [[ $# == 0 ]]; then
				printf "%s\n" "Dotfile Installer"
				printf "%s\n" "Usage: $0 [-b|--base|--(no-)base] [-s] [-c] [-l] [-d] [-q]"
				printf "  %s\n" "-b,--base,--no-base: Run base module (on by default)."
				printf "  %s\n" "-s: Show managed dotfiles."
				printf "  %s\n" "-c: Check for broken symlinks in \$HOME directorys."
				printf "  %s\n" "-l: Symlink dotfiles (existing files are skipped)."
				printf "  %s\n" "-d: Delete dotfiles."
				printf "  %s\n\n" "-q: Quit/Exit."
				read -r -p "[?] Enter selection: " response
				printf "\n"
				process_option "$response"
			else
				process_option "$@"
			fi
			break
		done
	else
		printf "[X] %s\n" "ERROR: $HOME does not exist."
		return 1
	fi
}

main "$@"
